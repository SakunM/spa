第3章　シェルの開発 	後半			A:\PJ\spa\SnapShots\sec3-2\sec.txt


後半のメイン作業はスライダーの開閉をブラウザの履歴管理とシンクロさせるためにjQureryのuriAnctorモジュールを使用する事だ。
ウエブアプリはブラウザの右上にある履歴や戻るボタンなどを非表示に設定する事は出来ない。
なので、ユーザーがこれらのボタンを操作したときに、このアプリはどのように振舞うのかを決定しなくてはならない。
もちろん、無視する事も出来るけど、このアプリにとっての履歴ボタンがどのように働くべきかを考える良い機会だ。

このアプリは会員制のチャットアプリで仲の良い友達だけが参加できる。
現在、実装の初期段階なので手動でスライダーの開閉を行っているけど、本来はログイン承認が通った場合にアプリによって開かれる。
なので、ユーザーにとって、ログイン承認のためパスワードを入力したり、名前を入力したりと何かと面倒な作業だ。

なので、一度認証されたユーザーがたとえ違うサイトに行った後にこのアプリに戻ったときまた最初から認証をするのは印象が悪い。
また、アプリの性質上、商取引が絡むよう事は無いので、戻るボタンはスライダーの開閉を管理してもらう事が妥当だと判断した。
ただし、履歴の管理に余り多くの作業を入れ込む事もアプリの動作速度に影響する。なので、履歴は認証だけを管理して、
以前のチャット内容や話し相手などは管理しない事にする。

自分の検索キーワードが未熟なせいか、ブラウザの履歴管理に関する情報やuriAnctorの挙動についての情報は今のところあまりない。
なので、ちょっとしたテストメソッドをspa.jsに仕込む事で挙動をチェックしてみた所、あくまで自分の想像だけど、
ブラウザの履歴管理はURI表示ペインに、通常のuriの後ろにハッシュ記号と感嘆符（#!）で修飾されたオブジェクト表現だ。
多少複雑な物でも表現が出来るように入れ子の構造を持ちキーと値の間にそれぞれ意味を持つ記号が挟まっている。
その文字列を取得してJavaScriptのオブジェクトに変換するのが、uriAnctor#makeAnctorMapで逆にJavaScriptのオブジェクトを
その文字列に変換して履歴管理に挿入するのがuriAnctor#setAnctorだ。また挿入されるとwindowがhashchangeイベントを発火する。
また、ユーザーが戻るボタンなどを押しても、同じイベントが発火する。なので、そのリスナーをspa.jsに置いて、
手動でのクリックイベントのリスナーからも、履歴管理リスナーを呼ぶようにすればスライダーの開閉を一元管理できる。

ただ、uriAnchor#makeAnchorMapの仕様が、ブラウザの履歴管理がシンプルな#!chat=openedのような文字列だとしても、
オブジェクトに変換する時点で、{chat: "opened", _s_chat: "opened"}　_s_chatという従属キーを自動で付け足す事だ。
この仕様の必要性が分からない、今回のアプリに関しては事を複雑にするばかりだ。
ハッシュチェンジのリスナの実装で、本書では従属キーを取り出す処理が有るけど、主キーの比較だけで現在の実装で処理できる。
ほんとに従属キーを使わないといけない場面に出くわすまでは、自分の実装ではスライダーの開閉のトリガは主キーの比較で行う。

また、手動の開閉とハッシュチェンジをリンクさせるメソッド、changeAnchorを呼び出すルートはスライダーに忍ばせた、
setAnchorコールバックメソッドしかない。そしてここでchangeAnchorに渡す引数は従属キーのない主キーのみのオブジェクトだ。なので、
changeAnchorの実装で、従属キーを取り除く処理は無用だと思える。ここもほんとに必要になるまで余計に思える処理はカットする。

5章まで、進んでまた戻って来てきてしまった（笑）。自分はまだ、ブラウザの履歴管理とuriAnctorの関係について、
まだよくわかっていない。でも、もう一度確かめたところ、少なくとも今の実行ルートでは、勝手に生成される従属キーを使わなくても、
主キーのみの参照で問題無い事は確認できた。本書ではonHashChangeでも、スライダー開閉の実行検査で従属キーで比べているけど、
主キーでの比較で問題ない。その意図がはっきりするまで、自分はやはりこのまま様子を見る事にする。


第1章　最初のシングルページアプリケーション　		A:\PJ\spa\SnapShots\sec1\sec.txt
第2章　JavaScriptのおさらい			A:\PJ\spa\SnapShots\sec2\sec.txt
第3章　シェルの開発 前半			A:\PJ\spa\SnapShots\sec3-1\sec.txt
第3章　シェルの開発 後半			A:\PJ\spa\SnapShots\sec3-2\sec.txt
第4章　機能モジュールの追加		前編			A:\PJ\spa\SnapShots\sec4-1\sec.txt
第4章　機能モジュールの追加		中編			A:\PJ\spa\SnapShots\sec4-2\sec.txt
第4章　機能モジュールの追加		後編			A:\PJ\spa\SnapShots\sec4-3\sec.txt
GitHub アドレス			https://github.com/SakunM/spa
SPAファイナルReadMe			A:\PJ\spa\readme.txt
前々回の最終バージョン	A:\PJ\JS\all\spas\spa10
前回の最終バージョン	A:\PJ\mamo2\langs\SPA
今回のバージョン		A:\PJ\spa
再々のSPA		A:\プログラミング\書籍サンプル\JS\JavaScript\SPA\再々のSPA.txt
