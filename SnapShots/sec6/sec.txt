第6章　モデルとデータモジュールの完成			A:\PJ\spa\SnapShots\sec6\sec.txt

この章はフロントサイドの最終章だ。なので、かなりの量のタスクをこなす事になる。
ただし、章を通して同じファイルの上書きの処理はあまりないのでShapShotsの分割は今のところ考えない。
章の前半はmodel.jsのチャット機能、５つのwebTestで完成させた。
まず、aboutPebblesの最初の実装はモデルの初期化で無条件にユーザーのリストをもらう事が前提だったけど、
実装が成長して、ログインに成功しないとリストは貰えない仕様になったので、タイマーセット内に検証コードを移す。
また、データベースのクリアの手法も変化したので、ログアウトはstateのanonをチェックする。
このテストは主にTAFFYからのデータの出し入れのテストだ。続くaboutAlfredは進化したログインとログアウトをテストする。
aboutFredは、ログイン後にチャットに参加する事でメンバーのリストをサーバーからもらえる事チェックする。
aboutFannyは、ログイン後にサーバーに参加して、チャット相手を決めれば、メンバーと送受信が出来る事をチェック。
最後のaboutJessyはメンバーをアバターと呼び、アバターのCSSが変った事をサーバーに知らせれればすべてのメンバーに
知らせる事をテストする。

中盤は、jquery.event.geventを使って、各機能モジュールがモデルから情報を受け取る仕組みに力点が移る。
まずは、モデルとスライダーの連携からだ。スライダーのコードが肥大化するのでやはりコラボを考える。

モデルのコラボはチャットとメンバー管理はお互いの依存が強すぎる、ログイン処理一つとってもお互いのやり取りが多すぎて、
二つに分ける事は混乱のもとだ、なので、チャットとステートという二つのオブジェクトをクラスで共有して、
モデルの役割はサーバーとシェルのメッセージの窓口にして、コラボは自らは状態を持たずにメッセージイベントと、
二つのオブジェクトの状態を使って、純粋関数のように振舞うように設計した。

でも、スライダーのコラボはすこし事情が異なる。前々から持っていたスライダーの開閉にやリサイズ時のスライダーのサイズ管理などは、
コラボにまかせる。なのでコラボは状態を管理する。そして、スライダーはモデルが発行するイベントの管理とユーザーからのメッセージを
モデルに送る、モデルとの送受信が責務になる。もちろん、スライダーのコードの肥大化を防ぐような純粋関数もコラボに置く。
これらの状態はあくまでスライダーで管理して、コラボは状態をキャシュしない。

最後は、メインやコンテンツペインを動き回る、アバターの導入だ。チャットメンバーに扮したアバターは状態のよって、
衣装の色を変えたり、マウスの長押しドラッグで移動したりする。そして、このアバターの変化をサーバーに伝えて、
すべてのメンバーで共有したい。つまり、こちらもモデルとの送受信が必要だ。なので、こちらの戦略もスライダーに近い。
それに、次の章でのサーバー編に入る前のレイアウトの可能性も追求したい。

実は、すでにスライダーは新しいレイアウトを導入済みだ。スライダー本体の位置だけは、アブソリュート値を使うけど、
中身のレイアウトの全体は2列3行のグリッドで、一行目のheadはフロウ、親で設定した2行と3行の左はlist、2行2列がmsg。
3行2列のformの中はフロウでinputとsendを並べて配置した。無論リサイズ時の対応のために2行目をfr値を採用したので、対応済みだ。
調子に乗って親のSPAには新しいレイアウトを採用したい。　フロウやグリッドを使うと、親要素でレイアウトの枠組みが出来るので、
ラッパー要素が必要無くなる。また、相対レイアウトも容易だ。これからのレイアウトはアブソリュート値最小限に使いたい。
もちろん、使い処が無くなったわけではない。今回もSPAの最初の位置決めやスライダーの最初の位置決めはアブソリュート値を使った。

最後のアバターの処理は、余り苦労しない。戦略の進め方はモデルやスライダーの制作からあまり変化はない。
やはり、この章は同じモジュールの上書きに変化はないので、SnapShotsはsec6で決まりだ。

SPAファイナル			A:\PJ\spa\spa.txt
第1章　最初のシングルページアプリケーション　		A:\PJ\spa\SnapShots\sec1\sec.txt
第2章　JavaScriptのおさらい					A:\PJ\spa\SnapShots\sec2\sec.txt
第3章　シェルの開発 前半					A:\PJ\spa\SnapShots\sec3-1\sec.txt
第3章　シェルの開発 後半					A:\PJ\spa\SnapShots\sec3-2\sec.txt
第4章　機能モジュールの追加		前半		A:\PJ\spa\SnapShots\sec4-1\sec.txt
第4章　機能モジュールの追加　	中編		A:\PJ\spa\SnapShots\sec4-2\sec.txt
第4章　機能モジュールの追加　	後編		A:\PJ\spa\SnapShots\sec4-3\sec.txt
第5章　モデルの構築							A:\PJ\spa\SnapShots\sec5\sec.txt
第6章　モデルとデータモジュールの完成			A:\PJ\spa\SnapShots\sec6\sec.txt

GitHub アドレス			https://github.com/SakunM/spa
SPAファイナルReadMe			A:\PJ\spa\readme.txt
前々回の最終バージョン	A:\PJ\JS\all\spas\spa10
前回の最終バージョン	A:\PJ\mamo2\langs\SPA
今回のバージョン		A:\PJ\spa
再々のSPA		A:\プログラミング\書籍サンプル\JS\JavaScript\SPA\再々のSPA.txt
